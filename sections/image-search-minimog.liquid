
{% comment %} Minimog compatible image search section {% endcomment %}

<div class="m-image-search">
  <label class="m-button m-button--primary">
    Upload image
    <input type="file" accept="image/*" hidden id="mImgSearch">
  </label>
</div>

<script>
(function(){
  const input = document.getElementById('mImgSearch');
  input.addEventListener('change', async function(){
    const file = this.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = async () => {
      const base64 = reader.result.split(',')[1];

      const res = await fetch('https://storefront-image-search-production.up.railway.app', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ image: base64 })
      });

      const data = await res.json();
      if(!data.products || !data.products.length) return;

      window.location.href = '/search?q=' + data.products.join(' OR ');
    };
    reader.readAsDataURL(file);
  });
})();
</script>

<style>
.m-image-search {
  margin: 20px 0;
}
</style>
